---
// KaraokeText.astro â€” Synchronized prayer text display
---

<section class="karaoke-section" aria-label="Prayer text">
  <!-- Mystery announcement -->
  <div id="mystery-announcement" class="mystery-announcement" style="display:none;">
    <div class="mystery-label">Mystery</div>
    <div class="mystery-name-display" id="mystery-name"></div>
    <div class="mystery-meditation" id="mystery-meditation"></div>
  </div>

  <!-- Prayer title -->
  <div class="prayer-header">
    <h2 id="prayer-title" class="prayer-title"></h2>
  </div>

  <!-- Primary language karaoke text -->
  <div
    id="karaoke-primary"
    class="karaoke-text karaoke-primary"
    role="text"
    aria-live="polite"
    aria-atomic="false"
  ></div>

  <!-- Secondary language (optional) -->
  <div
    id="karaoke-secondary"
    class="karaoke-text karaoke-secondary"
    style="display:none;"
    aria-live="off"
  ></div>

  <!-- Language badges -->
  <div class="language-badges">
    <span class="lang-badge lang-primary" id="lang-badge-primary"></span>
    <span class="lang-badge lang-secondary" id="lang-badge-secondary" style="display:none;"></span>
  </div>
</section>

<script>
  // Watch for mystery announce steps and toggle the announcement display
  document.addEventListener('rosary-state-change', (e: CustomEvent) => {
    const state = e.detail;
    const announcement = document.getElementById('mystery-announcement');
    if (announcement) {
      const isMystery = state.currentStep?.prayer === 'mysteryAnnounce';
      announcement.style.display = isMystery ? 'block' : 'none';
    }
  });
</script>

<style>
  .karaoke-section {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    padding: 1rem 1.2rem;
    max-width: 680px;
    margin: 0 auto;
    width: 100%;
  }

  /* Mystery announcement */
  .mystery-announcement {
    background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 6px;
    padding: 1rem 1.2rem;
    animation: fadeInUp 0.5s ease;
  }

  .mystery-label {
    font-family: 'Cinzel', serif;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-bottom: 0.3rem;
  }

  .mystery-name-display {
    font-family: 'Cinzel', serif;
    font-size: clamp(1rem, 3.5vw, 1.4rem);
    font-weight: 600;
    color: var(--accent2);
    margin-bottom: 0.5rem;
    text-shadow: 0 0 20px var(--accent-glow);
  }

  .mystery-meditation {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-size: clamp(0.85rem, 2.5vw, 1rem);
    color: var(--text-dim);
    line-height: 1.7;
  }

  /* Prayer header */
  .prayer-header {
    padding-bottom: 0.3rem;
    border-bottom: 1px solid var(--border-dim);
  }

  .prayer-title {
    font-family: 'Cinzel', serif;
    font-size: clamp(0.85rem, 2.8vw, 1.15rem);
    font-weight: 400;
    letter-spacing: 0.1em;
    color: var(--text-gold);
    opacity: 0.9;
  }

  /* Karaoke text */
  .karaoke-text {
    font-family: 'Cormorant Garamond', serif;
    line-height: 1.9;
    min-height: 4em;
    overflow-y: auto;
    max-height: 30svh;
    padding: 0.5rem 0;
    scroll-behavior: smooth;
  }

  .karaoke-primary {
    font-size: clamp(1.05rem, 3.5vw, 1.35rem);
    color: var(--text);
  }

  .karaoke-secondary {
    font-size: clamp(0.85rem, 2.5vw, 1.05rem);
    color: var(--text-dim);
    font-style: italic;
    padding-top: 0.3rem;
    border-top: 1px solid var(--border-dim);
    margin-top: 0.3rem;
  }

  /* Karaoke word states */
  :global(.karaoke-word) {
    display: inline;
    transition: color 0.15s ease, text-shadow 0.15s ease;
    border-radius: 2px;
    padding: 0 1px;
  }

  :global(.karaoke-word.prayed) {
    color: var(--text-muted);
  }

  :global(.karaoke-word.active) {
    color: #ff3333;
    text-shadow: 0 0 12px rgba(255, 51, 51, 0.6);
    font-weight: 600;
    position: relative;
  }

  /* Disney-style red dot under active word */
  :global(.karaoke-word.active)::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 50%;
    transform: translateX(-50%);
    width: 5px; height: 5px;
    border-radius: 50%;
    background: #ff2222;
    box-shadow: 0 0 6px #ff2222, 0 0 12px rgba(255,34,34,0.5);
    animation: dotPulse 0.8s ease-in-out infinite;
  }

  @keyframes dotPulse {
    0%, 100% { transform: translateX(-50%) scale(1.0); opacity: 1; }
    50% { transform: translateX(-50%) scale(1.3); opacity: 0.8; }
  }

  /* Language badges */
  .language-badges {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
  }

  .lang-badge {
    font-family: 'Cinzel', serif;
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    border: 1px solid var(--border-dim);
    color: var(--text-muted);
    text-transform: uppercase;
  }

  .lang-primary {
    border-color: var(--gold-dim);
    color: var(--gold-dim);
  }
</style>
